var vm;

/* istanbul ignore else */
if (typeof process === 'object' && process.versions && process.versions.node) {
  vm = require('vm');
}

function evalView(input) {
  var code = [
    '"use strict";',
    'var emitted = false;',
    'var emit = function (a, b) {',
    '  emitted = true;',
    '};',
    'var view = ' + input + ';',
    'view(doc);',
    'if (emitted) {',
    '  return true;',
    '}'
  ].join('\n');

  /* istanbul ignore else */
  if (vm) {
    return vm.runInNewContext('(function(doc) {\n' + code + '\n})');
  } else {
    return new Function('doc', code);
  }
}

export default evalView;
